**Домашнее задание к занятию 1. «Введение в виртуализацию»**

Цели задания
Научиться запускать виртуальную машину в Yandex Cloud с минимальным расходом ресурсов.
Попрактиковаться в выборе платформы и системы управления виртуализации для решения требуемых задач.

# Задача 1

**Виртуальная машина**

**Дата создания 15.03.2025, 16:05**  

**Ресурсы:**  
| Параметр                    | Значение                      |
|-----------------------------|------------------------------|
| **Платформа**               | Intel Cascade Lake          |
| **Гарантированная доля vCPU** | 5%                           |
| **vCPU**                    | 2                            |
| **RAM**                     | 2 ГБ                         |
| **Объём дискового пространства** | 30 ГБ                   |
| **Прерываемая**             | ✅ Да                        |
| **Приложение Marketplac**   | Yandex Cloud Toolbox         |
| **Тип публичного IP**       | Динамический                 |
| **Публичный IPv4-адрес**    | 158.160.128.23               |
| **Прерываемая**             | ✅ Да                        |
![Параметры VM](Netology-SHDEVOPS-17/virtd-homeworks/05-virt-01-basics/settings_VM.png)

**Проверка установленного ПО:**
![Проверка установленного ПО](Netology-SHDEVOPS-17/05-virt-01-basics/ssh_docker_version.png)


# Задача 2

**Задание:**
Выбрать платформу в зависимости от задчи.
Абстракто без учета контестов.
Платформы:
1. физические сервера;
2. паравиртуализация;
3. виртуализация уровня ОС.

**Ответ:**
1. **Высоконагруженная база данных MySql, критичная к отказу:**
Оптимальный выбор - **физические сервера**, нет накладных расходов на виртаулизацию, прямой доступ к железу, аппаратный RAID на NVMe-дисках, репликации на уровне железа.
Высокие расходы на развертывание, масшатбирование и резервирование перекрывают финасовые потери в случае протоя из-за отказа в обслуживании.
Паравиртуализация - допустимое решение, если приоритет к гибкость над отказоусточивостью и накладные расходы допустимы.
Виртуализация уровня ОС - в PROD среде не допустима.

2. **Различные web-приложения:**
Оптимальный выбор - **виртуализация уровня ОС**, позволяет легко управлять разными сервисами, производя их: маштабирование, независимое обноеление, атоматизацию развертывания CI/CD.
Паравиртуализация - допустимое решение когда есть требования к жосткому разделению ресурсов или приложения требуют разных ОС.
Физические серверы – сомое догорогое и не оптимальное решение, сталкивался только в e-commerce платформах с экстремальной высокой нагрузкой.

3. **Windows-системы для использования бухгалтерским отделом:**
Оптимальный выбор - **Паравиртуализация**, (Hyper-V, VMware) так как Windows-гостевые ОС работают стабильно, поддерживается централизованное управление, резервирование и миграция ВМ.
Физические серверы – допустимое решение, если требуется высокая надежность, но менее гибкий вариант и более дорогой вариант.
Виртуализация уровня ОС – почти не используется, из-за Windows который не в полной мерее поддерживает контейниризацию.

4. **Системы, выполняющие высокопроизводительные расчёты на GPU:**
Оптимальный выбор - **физические сервера**, лучший вариант, так как обеспечивает максимальную производительность, доступ к GPU без проброса и танцов с бубном с драйверами.
Высокие расходы на развертывание, масшатбирование и резервирование перекрывают финасовые потери в случае протоя из-за отказа в обслуживании.
Паравиртуализация - допустимое решение, если нужно разделить GPU между несколькими VM и тем самым снизить стоимость решения и вопысить масштабируемость.
Виртуализация уровня ОС - не сталкивался, на сколько знаю в контейнеры не прокидывется GPU.

**Вывод:**
Выбор платформы это в первую очередь баланс между производительностью, масштабируюемостью, отказоустойчивостью и стоимостью. В большинстве случаев:
    - Физические серверы - предпочтительны для высоконагруженных и GPU-ориентированных задач.
    - Паравиртуализация – компромиссный вариант, обеспечивающий баланс между гибкостью и производительностью.
    - Виртуализация уровня ОС – оптимальна для масштабируемых сервисов и микросервисной архитектуры.

# Задача 3

**Задание:**
Выберите подходящую систему управления виртуализацией для предложенного сценария. Опишите ваш выбор.

**Ответ:**

**Сценарий 1:**
100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
**Выбор: Microsoft Hyper-V.**
**Причины выбора:**
1. Глубокая интеграция с Windows. 
2. Встроенные инструменты для балансировки нагрузки и репликации.
3. Возможности резервного копирования.
4. Управление через штатные средсва.
5. Поддержка Linux-гостевых ОС.
6. Лицензирование VMware дороже.

---
**Сценарий 2:**
Требуется наиболее производительное бесплатное open-source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.

**Выбор: Proxmox.**
**Причины выбора:**
1. Показывает отличную производительность и низкие накладные расходы на виртуализацию.
2. Поддержка как Windows, так и Linux ОС.
3. Встроенный механизм резервного копирования.
4. Web-интерфейс для удобного управления.
5. Поддержка кластеров и live-migration между узлами.
6. Бесплатен для большенсва контекстов решений.
7. XenServer и oVirt – тоже open-source, но сложнее в настройке.

---

**Сценарий 3:**
Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.

**Выбор: Microsoft Hyper-V (Core).**
**Причины выбора:**
1. Бесплатен в составе Windows Server Core.
2. Без GUI имеет низкую нагрузку сервер.
3. Максимальная совместимость с Windows-гостевыми ОС.
4. Встроенные средства резервного копирования и репликации.
5. Отличная производительность на Windows-хостах.
6. Совместимость с Windows инструментами: AD, GP, System Center, PowerShell.

---

**Сценарий 4:**
Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

**Выбор:** **VirtualBox + Vagrant (или Proxmox)**
**Причины выбора:**
1. Бесплатен и кроссплатформен.
2. Легко создавать и удалять виртуальные машины.
3. Vagrant – позволяет автоматизировать развертывание с разными дистрибутивами Linux.
4. Низкий порог входа.
5. Поддержка снапшотов.
7. Для командных решений можно использовать **Proxmox VE** или **oVirt** с развертыванием тестовых ВМ в веб-интерфейсе.


# Задача 4

**Задание:**
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет?

## Ответ

**Использование нескольких систем управления виртуализацией (например, VMware, KVM, Hyper-V, Proxmox, Xen) в одной инфраструктуре может привести к ряду проблем и недостатков:**
1. **Сложность администрирования**: требуется широкий набор компетенций у администраторов, повышается порог адаптации вновь принятых сотрудников.
2. **Различие архитектур гипервизоров** приводит к сложностям в миграции, резервировании, обновлении и лицензировании.
3. **Различные политики безопасности** усложняют поддержание заданного уровня безопасности в целом, а также увеличивают вероятность ошибок.

**Минимизация рисков и проблем**
1. **Ограничение количества гипервизоров** и использование максимально унифицированных инструментов управления (Ansible, Terraform) и мониторинга (Zabbix, Prometheus).
2. **Автоматизация**: управление созданием, миграцией и резервированием ВМ (с учетом различий гипервизоров).
3. **Глубокое документирование** всех процессов и стандартов.

**Вывод:**
Стоит максимально избегать или минимизировать создание неунифицированных систем и архитектур. Однако любое решение принимается в соответствии с контекстом решаемой задачи.
Например, в текущем проекте мы вынуждены использовать Hyper-V на серверах заказчика в соответствии с требованиями его ИТ-отдела. В связи с этим **STAGE-окружение** в нашей инфраструктуре также развернуто на Hyper-V, но **DEV-окружение** разворачивается на Proxmox из-за принятого стандарта разработки в рамках нашей организации. 

Также у каждого заказчика свои требования к архитектуре: один и тот же продукт развертывался как на KVM, так и в облачной среде конкретного заказчика.